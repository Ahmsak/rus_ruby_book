# Кодировка символов

Текст, который сохраняется в файле, для компьютера существует не в виде символов, а только как двоичные данные - числа из нулей и единиц. Каждый ноль или единица занимают один бит памяти. Восемь нулей или единиц занимают один байт. Обычно удобно записывать байты используя шестнадцатеричную систему счисления. Так ff в шестнадцатеричной системе соответствует 255 в десятичной и 11111111 в двоичной.

Каждому символу соответствует определенное число, хранящееся в памяти компьютера. Это число также называется кодовой позицией (code point) символа. Таблица, в которой соотносятся кодовые позиции и символы называется кодовой таблицей.

Кодировка - это способ представления символов в памяти компьютера (в виде набора байт). Например пробел хранится как 10000 (32 в десятичной системе счисления, 20 в шестнадцатеричной). Без информации об используемой кодировке компьютер не сможет правильно отобразить сохраненный набор байт. Обычно понятия кодировки и кодовой таблицы взаимозаменяемы.

В начале появления компьютеров повсевместно использовалась кодировка ASCII, включающая кодовые позиции для 127 символов: цифр, знаков, букв латинского алфавита и спецсимволов. Для предоставления 127 различных кодовых позиций хватает 7 бит памяти, поэтому кодовая позиция в ASCII полностью аналогична байту, хранящемуся в памяти.

В качестве минимальной единицы памяти обычно используется один байт. В одном байте может быть сохранено 255 различных кодовых позиций. Оставшиеся 128 чисел (от 128 до 255) использовались для представления национальных символов: букв национальных алфавитов и специфичных знаков.

Например слово hello хранится в памяти в виде набора байт 48 65 6c 6с 6a. Каждый байт одновременно является кодовой позицией символа.

Обилие национальностей и ограниченный набор различных вариаций битов привели к образованию огромного количества кодировок. Каждая кодировка по разному использовала оставшиеся кодовые позиции, представляя с их помощью разные символы. Это создавало сразу две проблемы: преобразования кодировок и ограниченности набора символов.

Для решения проблемы кодировок был создан стандарт Юникод (Unicode). Юникод был попыткой создать единый набор символов, который будет содержать в себе все символы всех языков на планете. В стандарте определены кодовые позиции символов, но не способ их хранения. Правила, согласно которым кодовые позиции преобразуются в байты (машинное представление), определяются Юникод-кодировками.

Кодовая позиция символа в Юникод записывается в формате U+xxxx, где x - это цифры в шестнадцатеричной системе счисления (может использоваться больше четырех цифр). Количество возможных кодовых позиций превышает миллион, что позволяет стандартизировать большинство существующих алфавитов. На данный момент стандарт содержит кодовые позиции около 100 тыс. символов.

Например, слово hello состоит из пяти кодовых позиций: U+0048 U+0065 U+006C U+006C U+006F.

Разные Юникод-кодировки довольно сильно отличаются. Слово hello может быть закодировано как в виде набора байт 00 48 00 65 00 6С 00 6С 00 6А, так и виде 48 00 65 00 6С 00 6С 00 6А 00. Существуют также кодировки, хранящие каждую кодовую позицию в четырех байтах.

В последнее время чаще всего используется Юникод-кодировка UTF-8. Она совместима с ASCII - для кодирования каждого символа, содержащегося в ASCII используется один байт (слово hello в UTF-8 кодируется так же как и в ASCII). Остальные символы кодируются двумя и более байтами. Это позволяет не хранить в памяти байты, содержащие только нули, и правильно обрабатывать ASCII символы.

Приступая к выполнению программы, интерпретатор получает лишь набор байт. В зависимости от внутренней кодировки эти байты могут интерпретироваться по разному. По умолчанию интерпретатор считает, что внутри программы используется кодировка ASCII ( **во второй версии Ruby** - UTF-8, поэтому в ней для изменения кодировки чаще всего нет необходимости ). Все лексические правила также определены относительно символов, содержащихся в ASCII.

Если в коде или комментариях (ведь это тоже одна из лексем) используются символы, не входящие в ASCII (например кириллица), необходимо вручную указывать кодировку программы.

Если текстовый редактор сохраняет код в кодировке, отличной от ASCII, то она также должна быть явно указана в качестве кодировки программы.

Кодировка устанавливается с помощью специального комментария, расположенного в самом начале программы: `#coding: название_кодировки`

Существует несколько отдельных лексических правил для такого комментария:

+ Вместо coding также может быть использовано encoding;
+ Вместо двоеточия также может использоваться знак равенства;
+ Пробелы до и после двоеточия игнорируются;
+ Весь комментарий не чувствителен к регистру;
+ Перед coding также может использоваться набор символов -*-.